<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>bruno - {{page.title}}</title>
	<link href="/assets/css/docs.css" media="all" rel="stylesheet" type="text/css">
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
	<script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
  </head>
  <body>
	<page>
		<toc>
			<a class='toc-toggle' title='table of contents'><i class="fa fa-bars"></i></a>
			<ol>
				<li>Table of Contents</li>
			</ol>
		</toc>			
		<content>{{content}}</content>
		<footer>
		(c) 2014 Jan Bernitt
		</footer>
	</page>
	<script>
function highlight(_, html) {
   return html
	.replace(/([a-z]+\s+)([-a-zA-Z0-9]+)(\s*(\[[^\]]+\]\s*)?::)/g, "$1<def>$2</def>$3")
	.replace(/(unit|dimension|data|fn|op|protocol|notation|where|ratio|instances|system|machine|behaviour|val|proc)(\s|$)/g, '<kw>$1</kw>$2')
	.replace(/("[^"]*"|'[^,. \)\]\t\n\r]+(\.[^,. \)\]\t\n\r]+)?|#[xdob]?[A-F0-9]+|`[^\s]+)/g, "<lit>$1</lit>")
	.replace(/(`[^\s]+)/g, "<atom>$1</atom>")
	.replace(/(@[^\s,A-Z][^\s,]*)/g, "<key>$1</key>")
	.replace(/(\?[a-z0-9]+)/g, "<var>$1</var>")
	.replace(/(\~)([a-z]|$)/g, "<op>$1</op>$2")
	.replace(/(\()(:=)/g, "$1<op>$2</op>")
	.replace(/<lit>('[0-9.e+-]+)([a-zA-Z]+)<\/lit>/g, "<lit>$1<uom>$2</uom></lit>")
	.replace(/(\s=\s|,|_|\s-&gt;|\\=|\\)/g, "<op>$1</op>")
	.replace(/(::)/g, "<as>$1</as>")
   	;
}

function toc(_, html) {
	$("toc ol").append("<li class='toc-"+html.tagName+"'><a href='#"+html.id+"'>"+html.innerHTML+"</a></li>");
}

$("content pre code").html(highlight);

$("content p code").html(highlight);

$(":header").each(toc);

$("toc a.toc-toggle").click(function() {
	$("toc").toggleClass("toc-down");
});

if ($(window).width() > $("page content").get(0).offsetWidth + 230 + 140) { 
	$(".footnotes li").each(function(n, e) { $("#"+e.id.replace("fn", "fnref\\")).before($("<ol class='sidenote'></ol>").html(e)); });
	$(".sidenote li p").each(function(n, e) { 
		var text = $("a[href='#"+$(this).parent().attr("id")+"']").first().text();
		$(this).prepend("<sup>"+text+" </sup>"); 
	});
}
/* adding extra anchors from headings */
$(":header").each(function(i,e) { 
	var names = $(e).text().replace(/([^\(]+)(\([^\)]+\))?/g, "$1").replace(/[-â€“]/g, ",").toLowerCase().split(/\s*(?:,|and)\s*/g);
	names.forEach(function(entry) {
		var anchor = entry.trim().replace(/\s+/g, "-");
		if (!document.getElementById(anchor)) {
			$(e).before("<a id='"+anchor+"'></a>");
		}
	});
 });
	</script>
  </body>
</html>
